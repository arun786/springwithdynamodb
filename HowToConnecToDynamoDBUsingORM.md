# To connect to DynamoDB using Object Persistence

## Model

Important annotations

1. @DynamoDBTable - this specifies the name of the table in DynamoDB.
2. @DynamoDBHashKey - this is the partition key of the table.
3. @DynamoDBRangeKey - this is the sort key of the table.
4. @DynamoDBAutoGeneratedKey - this generates an id
5. @DynamoDBIndexHashKey - this is for Global Secondary Index, partition key
6. @DynamoDBIndexRangeKey - this is for GSI and LSI, sort key
7. @DynamoDBAttribute - this depicts the column names
    
    
    package com.arun.springwithdynamodb.model;
    
    import com.amazonaws.services.dynamodbv2.datamodeling.*;
    import lombok.Getter;
    import lombok.Setter;
    
    import java.time.LocalDateTime;
    
    @DynamoDBTable(tableName = "Message")
    @Getter
    @Setter
    public class Message {
        //partition key
        @DynamoDBHashKey
        private String itemId;
    
        //sort key
        @DynamoDBRangeKey
        @DynamoDBAutoGeneratedKey
        private String messageId;
    
        @DynamoDBAttribute
        private String message;
    
        @DynamoDBAttribute
        private LocalDateTime dateTime;
    
        //GSI partition
        @DynamoDBIndexHashKey(globalSecondaryIndexName = "UserId-index")
        private String userId;
        //GSI sort key and LSI
        @DynamoDBIndexRangeKey(globalSecondaryIndexName = "UserId-index", localSecondaryIndexName = "Rating-index")
        private int rating;
    }

## To pass the values to the DynamoDB, we require the below class

    DynamoDBMapper which takes DynamoDB as a parameter in the constuctor.

    @Bean
    public DynamoDBMapper getDynamoDBClient() {
        AmazonDynamoDB dynamoDb = getDynamoDb();
        return new DynamoDBMapper(dynamoDb);
    }
    
    
   DynamoDBMapper has got various methods.
   1. save
   2. load
   3. delete
   4. scan
    
    
    package com.arun.springwithdynamodb.dao;
    
    import com.amazonaws.services.dynamodbv2.datamodeling.DynamoDBMapper;
    import com.amazonaws.services.dynamodbv2.datamodeling.DynamoDBScanExpression;
    import com.arun.springwithdynamodb.model.User;
    import org.springframework.beans.factory.annotation.Autowired;
    import org.springframework.stereotype.Repository;
    
    import java.util.List;
    
    @Repository
    public class UserDaoImpl implements UserDao {
    
        private DynamoDBMapper dynamoDBMapper;
    
        @Autowired
        public UserDaoImpl(DynamoDBMapper dynamoDBMapper) {
            this.dynamoDBMapper = dynamoDBMapper;
        }
    
        @Override
        public User addUser(User user) {
            dynamoDBMapper.save(user);
            return user;
        }
    
        @Override
        public User getUser(String id) {
            return dynamoDBMapper.load(User.class, id);
        }
    
        @Override
        public void delete(String id) {
            User user = new User();
            user.setUserId(id);
            dynamoDBMapper.delete(user);
        }
    
        @Override
        public List<User> getAllUser() {
            return dynamoDBMapper.scan(User.class, new DynamoDBScanExpression());
        }
    }
